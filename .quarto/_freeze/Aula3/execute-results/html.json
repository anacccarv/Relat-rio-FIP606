{
  "hash": "ef4989d335d14a97846ff2f22a8d960d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Gráficos com ggplot\"\nformat: html\neditor: visual\neditor_options: \n  chunk_output_type: inline\nmessage: false\nwarning: false\n---\n\n\n# Bibliotecas\n\nPacotes que foram utilizados na aula do dia 20/03/2024\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggthemes)\nlibrary(patchwork)\n```\n:::\n\n\n# Importação dos dados\n\nO conjunto dos dados está num arquivo .csv na web\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr <- read_csv(\"https://raw.githubusercontent.com/emdelponte/paper-coffee-rust-Ethiopia/master/data/survey_clean.csv\") \n\nglimpse(cr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 405\nColumns: 13\n$ farm            <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…\n$ region          <chr> \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", \"SNNPR\", …\n$ zone            <chr> \"Bench Maji\", \"Bench Maji\", \"Bench Maji\", \"Bench Maji\"…\n$ district        <chr> \"Debub Bench\", \"Debub Bench\", \"Debub Bench\", \"Debub Be…\n$ lon             <dbl> 35.44250, 35.44250, 35.42861, 35.42861, 35.42861, 35.3…\n$ lat             <dbl> 6.904722, 6.904722, 6.904444, 6.904444, 6.904444, 6.90…\n$ altitude        <dbl> 1100, 1342, 1434, 1100, 1400, 1342, 1432, 1100, 1400, …\n$ cultivar        <chr> \"Local\", \"Mixture\", \"Mixture\", \"Local\", \"Local\", \"Mixt…\n$ shade           <chr> \"Sun\", \"Mid shade\", \"Mid shade\", \"Sun\", \"Sun\", \"Mid sh…\n$ cropping_system <chr> \"Plantation\", \"Plantation\", \"Plantation\", \"Plantation\"…\n$ farm_management <chr> \"Unmanaged\", \"Minimal\", \"Minimal\", \"Unmanaged\", \"Unman…\n$ inc             <dbl> 86.70805, 51.34354, 43.20000, 76.70805, 47.15808, 51.3…\n$ sev2            <dbl> 55.57986, 17.90349, 8.25120, 46.10154, 12.25167, 19.91…\n```\n\n\n:::\n:::\n\n\n## Visualização dos dados\n\nVamos utilizar a biblioteca **ggplot2** para visualizar os dados do conjunto.\n\nComo está distribuída a incidência da ferrugem do café nas 405 fazendas?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(inc))+\n  geom_histogram()\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nVimos que não é uma distribuição normal, é multimodal (mais de um pico de maior inc)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(cr$inc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   9.50   19.43   32.50   34.89   48.20   86.71 \n```\n\n\n:::\n:::\n\n\nA inc da ferrugem variou de 9,50% a 86,71%, com média de 32,50% e mediana de 32,50%.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(x = farm, y = inc))+\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Sumarização e visualização dos dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(inc))+\n  geom_histogram()+\n  facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(inc))+\n  geom_boxplot()+\n  facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\nPelo boxplot é possível ver que a mediana mais alta, quando os dados são divididos de acordo com a região, que a incidência é mais alta em Oromia.\n\nPara saber a média, mediana e desvio padrão de inc das duas regiões:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  group_by(region) |> \n  summarise(inc_mean = mean(inc),\n            inc_sd = sd(inc),\n            inc_median = median(inc))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  region inc_mean inc_sd inc_median\n  <chr>     <dbl>  <dbl>      <dbl>\n1 Oromia     37.0   14.6       39.5\n2 SNNPR      33.4   18.9       29.6\n```\n\n\n:::\n:::\n\n\nMesma coisa para cultivar:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  group_by(cultivar) |> \n  summarise(inc_mean = mean(inc),\n            inc_sd = sd(inc),\n            inc_median = median(inc))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  cultivar inc_mean inc_sd inc_median\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Improved     16.4   5.66       15.2\n2 Local        53.4  14.3        50.9\n3 Mixture      31.9  11.2        31.6\n```\n\n\n:::\n:::\n\n\nQuero saber o que é mais interessante? Usar severidade ou inc? Existe alguma relação entre elas?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(inc, sev2))+\n  geom_point( )\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nÉ possível ver que há um aumento da severidade conforme a incidência aumenta. A partir disso, é possível criar um modelo para predizer/estimar a severidade de acordo com a incidência, já que foi verificado essa relação entre essas duas variáveis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(sev2))+\n  geom_histogram()+\n  facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nDe acordo com a severidade, a distribuição também é assimétrica - indica que a mediana e a média são mais distantes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  #group_by(cultivar) |> \n  summarise(sev_mean = mean(sev2),\n            sev_sd = sd(sev2),\n            sev_median = median(sev2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  sev_mean sev_sd sev_median\n     <dbl>  <dbl>      <dbl>\n1     9.09   9.22       5.95\n```\n\n\n:::\n:::\n\n\nA média está mais alta do que a mediana (a média está sendo influenciada pelos outliers - aqueles valores com a severidade mais alta).\n\nQuando se tem uma situação mais simétrica (mais próximo da normalidade), a média e a\\\nmediana estão mais próximas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  group_by(cultivar) |> \n  summarise(sev_mean = mean(sev2),\n            sev_sd = sd(sev2),\n            sev_median = median(sev2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 4\n  cultivar sev_mean sev_sd sev_median\n  <chr>       <dbl>  <dbl>      <dbl>\n1 Improved     2.16   1.82       1.64\n2 Local       18.7   11.1       17.2 \n3 Mixture      6.47   4.35       5.43\n```\n\n\n:::\n:::\n\n\nTem tendência de maior homogeniedade dentro de cada grupo (medianas e médias mais próximos para cada cultivar).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(sev2))+\n  geom_histogram()+\n  facet_wrap(~cultivar)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(sev2))+\n  geom_histogram()+\n  facet_wrap(~region)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncr |> \n  ggplot(aes(sev2, fill = region))+\n  scale_fill_colorblind()+\n  geom_histogram(color = \"white\")+\n  facet_wrap(region ~ cultivar, ncol = 3)+\n  theme_clean(base_size = 14)+\n  theme(legend.position = \"bottom\")+\n  labs(y = \"Frequency\",\n       x = \"Severity (%)\",\n       fill = \"Region\")\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"plot2.png\", bg = \"white\")\n```\n:::\n\n\nÉ possível ver que, de maneira geral, a severidade para as cultivares se mantém similar independente da região.\n\n# Criar subconjuntos\n\nSeleção de colunas = `select()` e filtragem de linhas = `filter()` (ambas funções do pacote **dplyr**). Como o **tidyverse** contempla o **dplyr** e já foi carregado, não é necessário carregar o pacote **dplyr**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# filtra Oromia\ncr_oromia <- cr |> \n  select(farm, region, cultivar, sev2) |> \n  filter(region == \"Oromia\")\n\n# filtra SNNPR\ncr_pr <- cr |> \n  select(farm, region, cultivar, sev2) |> \n  filter(region == \"SNNPR\")\n```\n:::\n\n\nUtiliza as funções `select()`e `filter()` para selecionar as colunas e linhas respectivamente.\n\n## Visualização dos subconjuntos\n\nGráficos **ggplot** para cada subconjunto\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- cr_oromia |> \n  ggplot(aes(cultivar, sev2, fill = cultivar))+\n  geom_boxplot()+\n  labs(#title = \"Oromia\",\n       y = \"Severity (%)\",\n       x = \"Cultivar\",\n       fill = \"Cultivar\")\n\n\np2 <- cr_pr |> \n  ggplot(aes(cultivar, sev2, fill = cultivar))+\n  geom_boxplot()+\n  labs(#title = \"SNNPR\",\n       y = \"Severity (%)\",\n       x = \"Cultivar\",\n       fill = \"Cultivar\")\n\n(p1 + p2)+ # coloca um gráfico ao lado do outro; o + pode ser substituído por |\n#p1 / p2 # coloca um gráfico em baixo do outro\nplot_layout(guides = 'collect')+ # para deixar apenas 1 legenda dos gráficos (já que é a mesma) \n  plot_annotation(tag_levels = \"A\")\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"patch1.png\")\n```\n:::\n\n\nPara fazer o mesmo gráfico, mas invertendo os eixos, de maneira mais rápida, sem precisar recriar todo o ggplot, utilizar a função `coord_flip()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- cr_oromia |> \n  ggplot(aes(cultivar, sev2, fill = cultivar))+\n  geom_boxplot()+\n  scale_fill_few()+\n  theme_few()+\n  labs(#title = \"Oromia\",\n    x = \"\",   \n    y = \"Severity (%)\",\n       fill = \"Cultivar\")+\n  coord_flip()\n\n\np2 <- cr_pr |> \n  ggplot(aes(cultivar, sev2, fill = cultivar))+\n  geom_boxplot()+\n  scale_fill_few()+\n  theme_few()+\n  labs(#title = \"SNNPR\",\n    x = \"\",  \n    y = \"Severity (%)\",\n       fill = \"Cultivar\")+\n  coord_flip()\n\np3 <- cr_oromia |> \n  ggplot(aes(x = sev2))+\n  geom_histogram()\n```\n:::\n\n\n## Utilizando o **patchwork**\n\nO pacote **patchwork** foi utilizado para fazer essa junção de mais de um gráfico em apenas uma imagem.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#(p1 + p2)+ # coloca um gráfico ao lado do outro; o '+' pode ser substituído por '|'\n(p1 / p2)+ # coloca um gráfico em baixo do outro\nplot_layout(guides = 'collect',\n            axes = 'collect') +\n  plot_annotation(tag_levels = \"A\")+\n  plot_annotation(title = \"Coffee rust in Ethiopia\",\n                  caption = \"Source: Del Ponte (2022)\")\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"patch2.png\", width = 6, height = 4)\n```\n:::\n\n\nPara inserir um gráfico dentro de outro gráfico usar a função `insect_element()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 + inset_element(p3, left = 0.6, bottom = 0.6, right = 1, top = 1)\n```\n\n::: {.cell-output-display}\n![](Aula3_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}